{
    "type": "Ext.app.Controller",
    "reference": {
        "name": "items",
        "type": "array"
    },
    "codeClass": null,
    "userConfig": {
        "designer|userClassName": "Navigation",
        "requires": [
            "Ext.History"
        ]
    },
    "designerId": "6773ed43-4d1d-4a53-8df3-901ba8881cb0",
    "cn": [
        {
            "type": "fixedfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "fn": "onLaunch",
                "implHandler": [
                    "Ext.History.init();",
                    "",
                    "Ext.History.on('change',function (hash){",
                    "    aux=hash.split('/');",
                    "",
                    "    switch(aux[0]){",
                    "        case 'SpikeChart':",
                    "            Ext.ComponentQuery.query('#Controls')[0].down('#SpikeControls').down('#SpikeIntervalSearch').show(true);",
                    "            ",
                    "            this.getNavigationPanel().getLayout().setActiveItem(this.getSpikeChartPanel());",
                    "                switch(aux[1]){",
                    "                    case undefined:",
                    "                        break;",
                    "                    case 'Uncorrected':",
                    "                        this.showUncorrected();",
                    "                        break;",
                    "                    case 'Pressure':",
                    "                        this.showPressure();",
                    "                        break;",
                    "                    case 'Efficiency':",
                    "                        this.showEfficiency();",
                    "                        break;",
                    "                    default:",
                    "                        console.log('Chart--> '+hash);",
                    "                }",
                    "            break;",
                    "        case 'SpikeChart2':",
                    "            Ext.ComponentQuery.query('#Controls')[0].down('#SpikeControls').down('#SpikeIntervalSearch').hide(true);",
                    "",
                    "            this.getNavigationPanel().getLayout().setActiveItem(this.getSpikeChannelChartPanel());",
                    "                MyApp.app.chartChannels.showLoading('Loading data from server...');",
                    "                Ext.Ajax.request({",
                    "                    url: '/nmdadb/rawdata/'+Math.round(MyApp.app.chart.xAxis[0].min/1000)+'/'+Math.round(MyApp.app.chart.xAxis[0].max/1000),",
                    "                    success: function(response){",
                    "                        var text = response.responseText;",
                    "                        data=Ext.JSON.decode(text);",
                    "",
                    "                        for (var i=0;i<=17;i++){",
                    "                            MyApp.app.chartChannels.series[i].setData(data[i]);",
                    "                        }",
                    "",
                    "                        MyApp.app.chartChannels.hideLoading();",
                    "                        MyApp.app.chartChannels.hideLo$ading();",
                    "",
                    "                    },",
                    "                    scope: this",
                    "                });",
                    "            break;",
                    "        case 'SpikeStat':",
                    "            this.getNavigationPanel().getLayout().setActiveItem(this.getSpikeStatPanel());",
                    "            break;",
                    "        case 'SpikeCorr':",
                    "            this.getNavigationPanel().getLayout().setActiveItem(this.getSpikeCorrPanel());",
                    "            var panel=this.getNavigationPanel().down('#SpikeCorrChartPanel');",
                    "            var N_points=Math.round(panel.getWidth()/4);",
                    "",
                    "                    if (MyApp.app.chartSpikeCorr){}else{",
                    "",
                    "            Ext.Ajax.request({",
                    "                url: '/nmdb/corrected/group/all/all/'+ N_points,",
                    "                success: function(response){",
                    "                    var text = response.responseText;",
                    "                    data=Ext.JSON.decode(text);",
                    "                    data[0] = [].concat(data[0], [[Date.now(), null, null, null, null]]);",
                    "",
                    "                    MyApp.app.dataCorr=data;",
                    "",
                    "                        var Letter = 65;//ASCII-->A",
                    "                        MyApp.app.chartSpikeCorr = new Highcharts.StockChart({",
                    "                                    chart: {",
                    "                                        renderTo: panel.getEl().dom,",
                    "",
                    "                                        zoomType: 'x'",
                    "                                    },",
                    "",
                    "                                    title: {",
                    "                                        text: 'Spike Correction Tool'",
                    "                                    },",
                    "",
                    "                                    global: {",
                    "                                        useUTC: true",
                    "                                    },",
                    "",
                    "                                    rangeSelector: {",
                    "                                        buttons: [{",
                    "                                            type: 'month',",
                    "                                            count: 1,",
                    "                                            text: '1m'",
                    "                                        },{",
                    "                                            type: 'all',",
                    "                                            text: 'All'",
                    "                                        }],",
                    "                                        selected: 1,",
                    "                                        inputEnabled: false",
                    "                                    },",
                    "",
                    "                                    xAxis : {",
                    "                                        events : {",
                    "                                            afterSetExtremes : function(event){",
                    "                                                MyApp.app.chartSpikeCorr.showLoading('Loading data from server...');",
                    "",
                    "                                                if ((Math.round(event.max/1000)-Math.round(event.min/1000))/60<=N_points*4+4){",
                    "                                                    Ext.Ajax.request({",
                    "                                                        url: '/nmdb/corrected/raw/'+Math.round(event.min/1000)+'/'+Math.round(event.max/1000),",
                    "                                                        success: function(response){",
                    "                                                            var text = response.responseText;",
                    "                                                            data=Ext.JSON.decode(text);",
                    "                                                            MyApp.app.dataCorr=data;",
                    "                                                            MyApp.app.IsCandle = false;",
                    "                                                            //Ext.ComponentQuery.query('#Chart2Button')[0].enable(true);",
                    "                                                            MyApp.app.chartSpikeCorr.series[0].setData([]);",
                    "                                                            MyApp.app.chartSpikeCorr.series[1].setData([]);",
                    "                                                            MyApp.app.chartSpikeCorr.series[2].setData([]);",
                    "                                                            MyApp.app.chartSpikeCorr.series[3].setData([]);",
                    "                                                            MyApp.app.chartSpikeCorr.series[4].setData([]);",
                    "                                                            MyApp.app.chartSpikeCorr.series[5].setData([]);",
                    "                                                            if (MyApp.app.IsUncorrected){",
                    "                                                                MyApp.app.chartSpikeCorr.series[0].setData([]);",
                    "                                                                MyApp.app.chartSpikeCorr.series[1].setData(data[0]);",
                    "                                                            }",
                    "                                                            if (MyApp.app.IsCorrPress){",
                    "                                                                MyApp.app.chartSpikeCorr.series[2].setData([]);",
                    "                                                                MyApp.app.chartSpikeCorr.series[3].setData(data[1]);",
                    "                                                            }",
                    "                                                            if (MyApp.app.IsCorrEffic){",
                    "                                                                MyApp.app.chartSpikeCorr.series[4].setData([]);",
                    "                                                                MyApp.app.chartSpikeCorr.series[5].setData(data[2]);",
                    "                                                            }",
                    "                                                            MyApp.app.chartSpikeCorr.series[6].setData(data[3]);",
                    "",
                    "                                                            MyApp.app.chartSpikeCorr.hideLoading();",
                    "                                                            MyApp.app.chartSpikeCorr.hideLoading();",
                    "",
                    "                                                        },",
                    "                                                        scope: this",
                    "                                                    });",
                    "",
                    "                                                }else{",
                    "                                                    Ext.Ajax.request({",
                    "                                                        url:'/nmdb/corrected/group/'+Math.round(event.min/1000)+'/'+Math.round(event.max/1000)+'/'+N_points,",
                    "                                                        success: function(response){",
                    "                                                            var text = response.responseText;",
                    "                                                            data=Ext.JSON.decode(text);",
                    "                                                            MyApp.app.dataCorr=data;",
                    "                                                            MyApp.app.IsCandle = true;",
                    "                                                            //Ext.ComponentQuery.query('#Chart2Button')[0].disable(true);",
                    "                                                            MyApp.app.chartSpikeCorr.series[0].setData([]);",
                    "                                                            MyApp.app.chartSpikeCorr.series[1].setData([]);",
                    "                                                            MyApp.app.chartSpikeCorr.series[2].setData([]);",
                    "                                                            MyApp.app.chartSpikeCorr.series[3].setData([]);",
                    "                                                            MyApp.app.chartSpikeCorr.series[4].setData([]);",
                    "                                                            MyApp.app.chartSpikeCorr.series[5].setData([]);",
                    "",
                    "                                                            if (MyApp.app.IsUncorrected){",
                    "                                                                MyApp.app.chartSpikeCorr.series[0].setData(data[0]);",
                    "                                                                MyApp.app.chartSpikeCorr.series[1].setData([]);",
                    "                                                            }",
                    "                                                            if (MyApp.app.IsCorrPress){",
                    "                                                                MyApp.app.chartSpikeCorr.series[2].setData(data[1]);",
                    "                                                                MyApp.app.chartSpikeCorr.series[3].setData([]);",
                    "                                                            }",
                    "                                                            if (MyApp.app.IsCorrEffic){",
                    "                                                                MyApp.app.chartSpikeCorr.series[4].setData(data[2]);",
                    "                                                                MyApp.app.chartSpikeCorr.series[5].setData([]);",
                    "                                                            }",
                    "                                                            MyApp.app.chartSpikeCorr.series[6].setData(data[3]);",
                    "",
                    "                                                            MyApp.app.chartSpikeCorr.hideLoading();",
                    "                                                            MyApp.app.chartSpikeCorr.hideLoading();",
                    "                                                        },",
                    "                                                        scope: this",
                    "                                                    });",
                    "                                                }",
                    "",
                    "",
                    "                                            }",
                    "                                        },",
                    "                                        minRange: 1*(N_points)/*one Min*/*60*1000,",
                    "                                        ordinal: false,id:'ftf'",
                    "                                    },",
                    "",
                    "                                    navigator : {",
                    "                                        adaptToUpdatedData: false,",
                    "                                        series : {",
                    "                                            data : data[0]",
                    "                                        }",
                    "                                    },",
                    "",
                    "                                    scrollbar: {",
                    "                                        liveRedraw: false",
                    "                                    },",
                    "",
                    "                                    yAxis : [{",
                    "                                        title: {",
                    "                                            text: 'OHLC'",
                    "                                        },",
                    "                                        opposite: false,",
                    "                                        labels:{",
                    "                                            x:10",
                    "                                        },",
                    "                                        top: 150,",
                    "                                        height: 365,",
                    "                                        min: 20,",
                    "                                        max: 251",
                    "                                    },{",
                    "                                        title: {",
                    "                                            text: 'Presure'",
                    "                                        },",
                    "                                        opposite: false,",
                    "                                        labels:{",
                    "                                            x:10",
                    "                                        },",
                    "                                        height: 100,",
                    "                                        offset: 0,",
                    "                                        min: 880,",
                    "                                        max: 980",
                    "                                    }],",
                    "",
                    "                                    plotOptions: {",
                    "                                        column: {",
                    "                                            pointPadding: 0.2,",
                    "                                            borderWidth: 0",
                    "                                        }",
                    "                                    },",
                    "",
                    "                                    series:  [{",
                    "                                        name : 'Uncorrected',\t\t\t\t//0",
                    "                                        type : 'candlestick',",
                    "                                        data : data[0],",
                    "                                        dataGrouping: {",
                    "                                            enabled: false",
                    "                                        }",
                    "                                    },{",
                    "                                        name : 'Uncorrected',\t\t\t\t//1",
                    "                                        marker : {",
                    "                                            enabled : true,",
                    "                                            radius : 1",
                    "                                        },",
                    "                                        data : null,",
                    "                                        id: 'Unc',",
                    "                                        events: {",
                    "                                            //what happends when a point is clicked",
                    "                                            click: function(event) {",
                    "                                                for (var i=0;i<data[0].length;i++){",
                    "                                                    if (data[0][i][0]==event.point.x){",
                    "                                                        break;",
                    "                                                    }",
                    "                                                }",
                    "                                                var ClickedData=[data[0][i][0] , data[0][i][1] , data[1][i][1], data[2][i][1] , data[3][i][1]];",
                    "                                                MyApp.app.chartSpikeCorr.series[7].addPoint({x:event.point.x,title:String.fromCharCode(Letter)});",
                    "",
                    "                                                MyApp.app.chartSpikeCorr.redraw();",
                    "",
                    "                                                var markedGrid=Ext.ComponentQuery.query('#SpikeCorrPanel')[0].down('#MarkedGrid');",
                    "                                                markedGrid.store.add({\t",
                    "                                                                \"label\": String.fromCharCode(Letter),",
                    "                                                                \"start_date_time\": new Date(ClickedData[0]+new Date(ClickedData[0]).getTimezoneOffset()*60*1000),",
                    "                                                                \"un\": ClickedData[1],",
                    "                                                                \"ce\": ClickedData[2],",
                    "                                                                \"cp\": ClickedData[3],",
                    "                                                                \"pr\": ClickedData[4],",
                    "                                                                \"ver\": 0});",
                    "                                                Letter+=1;",
                    "                                                if(Letter==91)Letter=97;",
                    "                                                if(Letter==123)Letter=65;",
                    "                                            }",
                    "                                        },",
                    "                                        dataGrouping: {",
                    "                                            enabled: false",
                    "                                        }",
                    "                                    },{",
                    "                                        name : 'Corrected for Pressure',\t//2",
                    "                                        type : 'candlestick',",
                    "                                        data : null,",
                    "                                        dataGrouping: {",
                    "                                            enabled: false",
                    "                                        }",
                    "                                    },{",
                    "                                        name : 'Corrected for Pressure',\t//3",
                    "                                        data : null,",
                    "                                        dataGrouping: {",
                    "                                            enabled: false",
                    "                                        }",
                    "                                    },{",
                    "                                        name : 'Corrected for Efficiency',\t//4",
                    "                                        type : 'candlestick',",
                    "                                        data : null,",
                    "                                        dataGrouping: {",
                    "                                            enabled: false",
                    "                                        }",
                    "                                    },{",
                    "                                        name : 'Corrected for Efficiency',\t//5",
                    "                                        data : null,",
                    "                                        dataGrouping: {",
                    "                                            enabled: false",
                    "                                        }",
                    "                                    },{",
                    "                                        name : 'Pressure',\t\t\t\t\t//6",
                    "                                        visible : true,",
                    "                                        yAxis: 1,",
                    "                                        data : data[3],",
                    "                                        dataGrouping: {",
                    "                                            enabled: false",
                    "                                        }",
                    "                                    },{",
                    "                                        name : 'Flags',                    //7",
                    "                                        type: 'flags',",
                    "                                        data: null,",
                    "                                        y: -110,",
                    "                                        shape: 'squarepin',",
                    "                                        width : 16",
                    "                                    }]",
                    "                        });",
                    "",
                    "",
                    "",
                    "",
                    "                },",
                    "                scope: this",
                    "            });",
                    "",
                    "                    }",
                    "",
                    "",
                    "",
                    "",
                    "            break;",
                    "        case 'OtherModule':",
                    "            break;",
                    "        default:",
                    "            console.log(hash);",
                    "            break;",
                    "    }",
                    "},this);"
                ]
            },
            "designerId": "2cf6b7c5-0dce-4408-bc22-5b1a6912cf64"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "fn": "showUncorrected",
                "implHandler": [
                    "MyApp.app.chart.series[0].setData([]);",
                    "MyApp.app.chart.series[1].setData([]);",
                    "MyApp.app.chart.series[2].setData([]);",
                    "MyApp.app.chart.series[3].setData([]);",
                    "MyApp.app.chart.series[4].setData([]);",
                    "MyApp.app.chart.series[5].setData([]);",
                    "if(MyApp.app.IsCandle){",
                    "    MyApp.app.chart.series[0].setData(MyApp.app.data[0]);",
                    "    MyApp.app.chart.series[1].setData([]);",
                    "}else{",
                    "    MyApp.app.chart.series[0].setData([]);",
                    "    MyApp.app.chart.series[1].setData(MyApp.app.data[0]);",
                    "}"
                ]
            },
            "designerId": "8b017a64-a251-4c81-a0eb-8e56940f8538"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "fn": "showPressure",
                "implHandler": [
                    "MyApp.app.chart.series[0].setData([]);",
                    "MyApp.app.chart.series[1].setData([]);",
                    "MyApp.app.chart.series[2].setData([]);",
                    "MyApp.app.chart.series[3].setData([]);",
                    "MyApp.app.chart.series[4].setData([]);",
                    "MyApp.app.chart.series[5].setData([]);",
                    "if(MyApp.app.IsCandle){",
                    "    MyApp.app.chart.series[2].setData(MyApp.app.data[1]);",
                    "    MyApp.app.chart.series[3].setData([]);",
                    "}else{",
                    "    MyApp.app.chart.series[2].setData([]);",
                    "    MyApp.app.chart.series[3].setData(MyApp.app.data[1]);",
                    "}"
                ]
            },
            "designerId": "7b33eab7-3645-4ea5-94f3-7c0a4db1dd05"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "fn": "showEfficiency",
                "implHandler": [
                    "MyApp.app.chart.series[0].setData([]);",
                    "MyApp.app.chart.series[1].setData([]);",
                    "MyApp.app.chart.series[2].setData([]);",
                    "MyApp.app.chart.series[3].setData([]);",
                    "MyApp.app.chart.series[4].setData([]);",
                    "MyApp.app.chart.series[5].setData([]);",
                    "if(MyApp.app.IsCandle){",
                    "    MyApp.app.chart.series[4].setData(MyApp.app.data[2]);",
                    "    MyApp.app.chart.series[5].setData([]);",
                    "}else{",
                    "    MyApp.app.chart.series[4].setData([]);",
                    "    MyApp.app.chart.series[5].setData(MyApp.app.data[2]);",
                    "}"
                ]
            },
            "designerId": "afb76b00-ea4f-4767-a46e-df5e8777221c"
        },
        {
            "type": "controllerref",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "ref": "SpikeChartPanel",
                "selector": "#SpikeChartPanel"
            },
            "designerId": "0e338ef4-67f7-43d7-aa8f-38a51ab77a94"
        },
        {
            "type": "controllerref",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "ref": "SpikeStatPanel",
                "selector": "#SpikeStatPanel"
            },
            "designerId": "ae3b2a05-28cc-40ab-84ff-32d948dbc5a6"
        },
        {
            "type": "controllerref",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "ref": "navigationPanel",
                "selector": "#NavigationPanel"
            },
            "designerId": "d87df8ed-4e34-4988-bf98-e2f9fd4706ad"
        },
        {
            "type": "controllerref",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "ref": "SpikeCorrPanel",
                "selector": "#SpikeCorrPanel"
            },
            "designerId": "fc4fb5b0-9f06-4d92-898c-1fa9a35054a0"
        },
        {
            "type": "controllerref",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "ref": "SpikeChannelChartPanel",
                "selector": "#SpikeChannelChartPanel"
            },
            "designerId": "73cdcdde-9149-4d3f-af08-a3fce491dbe4"
        }
    ]
}