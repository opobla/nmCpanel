{
    "type": "Ext.app.Controller",
    "reference": {
        "name": "items",
        "type": "array"
    },
    "codeClass": null,
    "userConfig": {
        "designer|userClassName": "Spike"
    },
    "designerId": "e23011b7-c2c1-4bc3-a18c-9dbfde25de3d",
    "customConfigs": [
        {
            "group": "(Custom Properties)",
            "name": "item",
            "type": "string"
        }
    ],
    "cn": [
        {
            "type": "fixedfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "fn": "onLaunch",
                "implHandler": [
                    "MyApp.app.spike={};",
                    "MyApp.app.spike.panel=this.getSpikeChartPanel();",
                    "MyApp.app.spike.panelHeight=MyApp.app.spike.panel.getHeight();",
                    "MyApp.app.spike.panelWidth=MyApp.app.spike.panel.getWidth();",
                    "MyApp.app.spike.N_points=Math.round(MyApp.app.spike.panelWidth/4);",
                    "MyApp.app.spike.panelChannels=this.getSpikeChannelChartPanel();",
                    "MyApp.app.spike.data=null; //This is given value in loadSpikeData",
                    "",
                    "this.loadSpikeData();",
                    ""
                ]
            },
            "designerId": "cae7e7c1-7fa5-49d9-aae4-a0c378dd6cc8"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "fn": "loadSpikeData",
                "implHandler": [
                    "MyApp.app.spike.panel.setLoading(true);",
                    "",
                    "Ext.Ajax.request({",
                    "    url: '/nmdb/uncorrected/group/all/all/'+ MyApp.app.spike.N_points,",
                    "    success: function(response){",
                    "        var text = response.responseText;",
                    "        data=Ext.JSON.decode(text);",
                    "        data[0] = [].concat(data[0], [[Date.now(), null, null, null, null]]);  //  TODO make the server do this with the last data present in the database",
                    "        MyApp.app.spike.data=data;",
                    "        this.initSpikeChart();",
                    "        this.initSpikeChannelChart();",
                    "        MyApp.app.spike.panel.setLoading(false);",
                    "    },",
                    "    scope: this",
                    "});"
                ]
            },
            "designerId": "93531de4-3ce6-475c-8a0b-6fb6cbbeaf6e"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "N_points": 0,
                "fn": "initSpikeChart",
                "implHandler": [
                    "var data=MyApp.app.spike.data;",
                    "var panel=MyApp.app.spike.panel;",
                    "var panelChannel=MyApp.app.spike.panelChannels;",
                    "var N_points=MyApp.app.spike.N_points;",
                    "",
                    "var yAxisPressHeight=100;",
                    "var yAxisOhclHeight=MyApp.app.spike.panelHeight -yAxisPressHeight -165; //The 165 cant be changed",
                    "var yAxisOhclTop=yAxisPressHeight +50; //The 50 cant be changed",
                    "",
                    "function myfunc(){",
                    "    return true;",
                    "}",
                    "",
                    "debugger;",
                    "var chart = new Highcharts.StockChart({",
                    "            chart: {",
                    "                renderTo: panel.getEl().dom,",
                    "                zoomType: 'x'",
                    "            },",
                    "",
                    "            global: {",
                    "                useUTC: true",
                    "            },",
                    "",
                    "            rangeSelector: {",
                    "                buttons: [{",
                    "                    type: 'month',",
                    "                    count: 1,",
                    "                    text: '1m'",
                    "                },{",
                    "                    type: 'all',",
                    "                    text: 'All'",
                    "                }],",
                    "                selected: 1,",
                    "\t\t\t\tinputEnabled: false",
                    "            },",
                    "",
                    "\t\t\txAxis : {",
                    "                events : {",
                    "                    afterSetExtremes : function(event){",
                    "                        chart.showLoading('Loading data from server...');",
                    "",
                    "                        if ((Math.round(event.max/1000)-Math.round(event.min/1000))/60<=N_points*4+4){",
                    "                            Ext.Ajax.request({",
                    "                                url: '/nmdb/uncorrected/raw/'+Math.round(event.min/1000)+'/'+Math.round(event.max/1000),",
                    "                                success: function(response){",
                    "                                    var text = response.responseText;",
                    "                                    data=Ext.JSON.decode(text);",
                    "",
                    "                                    m=myfunc();",
                    "                                    debugger;",
                    "                                    MyApp.app.data=data;",
                    "                                    MyApp.app.IsCandle = false;",
                    "                                    Ext.ComponentQuery.query('#Chart2Button')[0].enable(true);",
                    "                                    chart.series[0].setData([]);",
                    "                                    chart.series[1].setData([]);",
                    "                                    chart.series[2].setData([]);",
                    "                                    chart.series[3].setData([]);",
                    "                                    chart.series[4].setData([]);",
                    "                                    chart.series[5].setData([]);",
                    "                                    if (MyApp.app.IsUncorrected){",
                    "                                        chart.series[0].setData([]);",
                    "                                        chart.series[1].setData(data[0]);",
                    "                                    }",
                    "                                    if (MyApp.app.IsCorrPress){",
                    "                                        chart.series[2].setData([]);",
                    "                                        chart.series[3].setData(data[1]);",
                    "                                    }",
                    "                                    if (MyApp.app.IsCorrEffic){",
                    "                                        chart.series[4].setData([]);",
                    "                                        chart.series[5].setData(data[2]);",
                    "                                    }",
                    "                                    chart.series[6].setData(data[3]);",
                    "",
                    "                                    chart.hideLoading();",
                    "                                    chart.hideLoading();",
                    "",
                    "                                },",
                    "                                scope: this",
                    "                            });",
                    "",
                    "                        }else{",
                    "                            Ext.Ajax.request({",
                    "                                url:'/nmdb/uncorrected/group/'+Math.round(event.min/1000)+'/'+Math.round(event.max/1000)+'/'+N_points,",
                    "                                success: function(response){",
                    "                                    var text = response.responseText;",
                    "                                    data=Ext.JSON.decode(text);",
                    "                                    MyApp.app.data=data;",
                    "                                    MyApp.app.IsCandle = true;",
                    "                                    Ext.ComponentQuery.query('#Chart2Button')[0].disable(true);",
                    "                                    chart.series[0].setData([]);",
                    "                                    chart.series[1].setData([]);",
                    "                                    chart.series[2].setData([]);",
                    "                                    chart.series[3].setData([]);",
                    "                                    chart.series[4].setData([]);",
                    "                                    chart.series[5].setData([]);",
                    "",
                    "                                    if (MyApp.app.IsUncorrected){",
                    "                                        chart.series[0].setData(data[0]);",
                    "                                        chart.series[1].setData([]);",
                    "                                    }",
                    "                                    if (MyApp.app.IsCorrPress){",
                    "                                        chart.series[2].setData(data[1]);",
                    "                                        chart.series[3].setData([]);",
                    "                                    }",
                    "                                    if (MyApp.app.IsCorrEffic){",
                    "                                        chart.series[4].setData(data[2]);",
                    "                                        chart.series[5].setData([]);",
                    "                                    }",
                    "                                    chart.series[6].setData(data[3]);",
                    "",
                    "                                    chart.hideLoading();",
                    "                                    chart.hideLoading();",
                    "                                },",
                    "                                scope: this",
                    "                            });",
                    "                        }",
                    "",
                    "",
                    "                    }",
                    "\t\t\t\t},",
                    "\t\t\t\tminRange: 0.75*(N_points)/*one Min*/*60*1000,",
                    "                ordinal: false",
                    "\t\t\t},",
                    "",
                    "\t\t\tnavigator : {",
                    "\t\t\t\tadaptToUpdatedData: false,",
                    "\t\t\t\tseries : {",
                    "\t\t\t\t\tdata : data[0]",
                    "\t\t\t\t}",
                    "\t\t\t},",
                    "",
                    "            scrollbar: {",
                    "\t\t\t\tliveRedraw: false",
                    "\t\t\t},",
                    "",
                    "\t\t\tyAxis : [{",
                    "\t\t\t\ttitle: {",
                    "                    text: 'OHLC'",
                    "                },",
                    "\t\t\t\tevents : {",
                    "\t\t\t\t\tafterSetExtremes : function(e){alert(e.max);}",
                    "\t\t\t\t},",
                    "                opposite: false,",
                    "                labels:{",
                    "                    x:10",
                    "                },",
                    "\t\t\t\ttop: yAxisOhclTop,",
                    "\t\t\t\theight: yAxisOhclHeight,",
                    "\t\t\t\tmin: 20,",
                    "\t\t\t\tmax: 251",
                    "\t\t\t},{",
                    "\t\t\t\ttitle: {",
                    "                    text: 'Presure'",
                    "                },",
                    "                opposite: false,",
                    "                labels:{",
                    "                    x:10",
                    "                },",
                    "\t\t\t\theight: yAxisPressHeight,",
                    "\t\t\t\toffset: 0,",
                    "\t\t\t\tmin: 880,",
                    "\t\t\t\tmax: 980",
                    "\t\t\t}],",
                    "",
                    "\t\t\tplotOptions: {",
                    "                column: {",
                    "                    pointPadding: 0.2,",
                    "                    borderWidth: 0",
                    "                }",
                    "            },",
                    "",
                    "            series:  [{",
                    "\t\t\t\tname : 'Uncorrected',\t\t\t\t//0",
                    "\t\t\t\ttype : 'candlestick',",
                    "\t\t\t\tdata : data[0],",
                    "\t\t\t\tdataGrouping: {",
                    "\t\t\t\t\tenabled: false",
                    "\t\t\t\t}",
                    "\t\t\t},{",
                    "\t\t\t\tname : 'Uncorrected',\t\t\t\t//1",
                    "\t\t\t\tdata : null,",
                    "                id: 'Unc',",
                    "\t\t\t\tdataGrouping: {",
                    "\t\t\t\t\tenabled: false",
                    "\t\t\t\t}",
                    "\t\t\t},{",
                    "\t\t\t\tname : 'Corrected for Pressure',\t//2",
                    "\t\t\t\ttype : 'candlestick',",
                    "\t\t\t\tdata : null,",
                    "\t\t\t\tdataGrouping: {",
                    "\t\t\t\t\tenabled: false",
                    "\t\t\t\t}",
                    "\t\t\t},{",
                    "\t\t\t\tname : 'Corrected for Pressure',\t//3",
                    "\t\t\t\tdata : null,",
                    "\t\t\t\tdataGrouping: {",
                    "\t\t\t\t\tenabled: false",
                    "\t\t\t\t}",
                    "\t\t\t},{",
                    "\t\t\t\tname : 'Corrected for Efficiency',\t//4",
                    "\t\t\t\ttype : 'candlestick',",
                    "\t\t\t\tdata : null,",
                    "\t\t\t\tdataGrouping: {",
                    "\t\t\t\t\tenabled: false",
                    "\t\t\t\t}",
                    "\t\t\t},{",
                    "\t\t\t\tname : 'Corrected for Efficiency',\t//5",
                    "\t\t\t\tdata : null,",
                    "\t\t\t\tdataGrouping: {",
                    "\t\t\t\t\tenabled: false",
                    "\t\t\t\t}",
                    "\t\t\t},{",
                    "\t\t\t\tname : 'Pressure',\t\t\t\t\t//6",
                    "\t\t\t\tvisible : true,",
                    "\t\t\t\tyAxis: 1,",
                    "\t\t\t\tdata : data[3],",
                    "\t\t\t\tdataGrouping: {",
                    "\t\t\t\t\tenabled: false",
                    "\t\t\t\t}",
                    "\t\t\t}]",
                    "});",
                    "",
                    "MyApp.app.chart=chart;"
                ]
            },
            "configAlternates": {
                "N_points": "number"
            },
            "designerId": "9477a0c7-1ebc-4b63-b248-cb65b6b7b33b",
            "customConfigs": [
                {
                    "group": "(Custom Properties)",
                    "name": "N_points",
                    "type": "string"
                }
            ]
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "fn": "initSpikeChannelChart",
                "implHandler": [
                    "var series = null;",
                    "var panel= MyApp.app.spike.panelChannels;",
                    "var height= MyApp.app.spike.panelHeight;",
                    "var width= MyApp.app.spike.panelWidth;",
                    "",
                    "var chartChannels = new Highcharts.StockChart({",
                    "    chart: {",
                    "        renderTo: panel.getEl().dom,",
                    "        height: height,",
                    "        width: width",
                    "    },",
                    "    title: {",
                    "        text: 'Hi there Spikes'",
                    "    },",
                    "    legend : {",
                    "        enabled: true",
                    "    },",
                    "    scrollbar:{",
                    "        enabled: false",
                    "    },",
                    "    navigator:{",
                    "        enabled: false",
                    "    },",
                    "    rangeSelector: {",
                    "        buttons: [],",
                    "        inputEnabled: false",
                    "    },",
                    "    yAxis:[{",
                    "        title: {",
                    "            text: 'Values'",
                    "        },",
                    "        opposite: false,",
                    "        labels:{",
                    "            x:10",
                    "        }",
                    "    }],",
                    "    xAxis:{",
                    "        ordinal: false",
                    "    },",
                    "    series: [{",
                    "        name: 'ch01',",
                    "        data: series,",
                    "        tooltip: {",
                    "            valueDecimals: 0",
                    "        },",
                    "        legendIndex: 1",
                    "    },",
                    "    {",
                    "        name: 'ch02',",
                    "",
                    "        data: series,",
                    "        tooltip: {",
                    "            valueDecimals: 0",
                    "        },",
                    "        legendIndex: 2",
                    "    },{",
                    "        name: 'ch03',",
                    "",
                    "        data: series,",
                    "        tooltip: {",
                    "            valueDecimals: 0",
                    "        },",
                    "        legendIndex: 3",
                    "    },{",
                    "        name: 'ch04',",
                    "",
                    "        data: series,",
                    "        tooltip: {",
                    "            valueDecimals: 0",
                    "        },",
                    "        legendIndex: 4",
                    "    },{",
                    "        name: 'ch05',",
                    "",
                    "        data: series,",
                    "        tooltip: {",
                    "            valueDecimals: 0",
                    "        },",
                    "        legendIndex: 5",
                    "    },{",
                    "        name: 'ch06',",
                    "",
                    "        data: series,",
                    "        tooltip: {",
                    "            valueDecimals: 0",
                    "        },",
                    "        legendIndex: 6",
                    "    },{",
                    "        name: 'ch07',",
                    "",
                    "        data: series,",
                    "        tooltip: {",
                    "            valueDecimals: 0",
                    "        },",
                    "        legendIndex: 7",
                    "    },{",
                    "        name: 'ch08',",
                    "",
                    "        data: series,",
                    "        tooltip: {",
                    "            valueDecimals: 0",
                    "        },",
                    "        legendIndex: 8",
                    "    },{",
                    "        name: 'ch09',",
                    "",
                    "        data: series,",
                    "        tooltip: {",
                    "            valueDecimals: 0",
                    "        },",
                    "        legendIndex: 9",
                    "    },{",
                    "        name: 'ch10',",
                    "",
                    "        data: series,",
                    "        tooltip: {",
                    "            valueDecimals: 0",
                    "        },",
                    "        legendIndex: 10",
                    "    },{",
                    "        name: 'ch11',",
                    "",
                    "        data: series,",
                    "        tooltip: {",
                    "            valueDecimals: 0",
                    "        },",
                    "        legendIndex: 11",
                    "    },{",
                    "        name: 'ch12',",
                    "",
                    "        data: series,",
                    "        tooltip: {",
                    "            valueDecimals: 0",
                    "        },",
                    "        legendIndex: 12",
                    "    },{",
                    "        name: 'ch13',",
                    "",
                    "        data: series,",
                    "        tooltip: {",
                    "            valueDecimals: 0",
                    "        },",
                    "        legendIndex: 13",
                    "    },{",
                    "        name: 'ch14',",
                    "",
                    "        data: series,",
                    "        tooltip: {",
                    "            valueDecimals: 0",
                    "        },",
                    "        legendIndex: 14",
                    "    },{",
                    "        name: 'ch15',",
                    "",
                    "        data: series,",
                    "        tooltip: {",
                    "            valueDecimals: 0",
                    "        },",
                    "        legendIndex: 15",
                    "    },{",
                    "        name: 'ch16',",
                    "",
                    "        data: series,",
                    "        tooltip: {",
                    "            valueDecimals: 0",
                    "        },",
                    "        legendIndex: 16",
                    "    },{",
                    "        name: 'ch17',",
                    "",
                    "        data: series,",
                    "        tooltip: {",
                    "            valueDecimals: 0",
                    "        },",
                    "        legendIndex: 17",
                    "    },{",
                    "        name: 'ch18',",
                    "",
                    "        data: series,",
                    "        tooltip: {",
                    "            valueDecimals: 0",
                    "        },",
                    "        legendIndex: 18",
                    "    }]",
                    "});",
                    "",
                    "MyApp.app.chartChannels=chartChannels;"
                ]
            },
            "designerId": "b344ac78-d987-4b48-8483-8b373793dbc4"
        },
        {
            "type": "controllerref",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "ref": "SpikeChartPanel",
                "selector": "#SpikeChartPanel"
            },
            "designerId": "72244de8-99cf-4b0c-b106-9ec157ad13e1"
        },
        {
            "type": "controllerref",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "ref": "SpikeChannelChartPanel",
                "selector": "#SpikeChannelChartPanel"
            },
            "designerId": "f9b8c75d-677d-4a81-b4ad-0c9447c2a79d"
        }
    ]
}