{
    "type": "Ext.app.Controller",
    "reference": {
        "name": "items",
        "type": "array"
    },
    "codeClass": null,
    "userConfig": {
        "designer|userClassName": "Spike"
    },
    "designerId": "e23011b7-c2c1-4bc3-a18c-9dbfde25de3d",
    "customConfigs": [
        {
            "group": "(Custom Properties)",
            "name": "item",
            "type": "string"
        }
    ],
    "cn": [
        {
            "type": "fixedfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "fn": "onLaunch",
                "implHandler": [
                    "MyApp.app.spike={};  // Spike module",
                    "MyApp.app.spike.panel=this.getSpikeChartPanel();",
                    "MyApp.app.spike.panelHeight=MyApp.app.spike.panel.getHeight();",
                    "MyApp.app.spike.panelWidth=MyApp.app.spike.panel.getWidth();",
                    "MyApp.app.spike.N_points=Math.round(MyApp.app.spike.panelWidth/4);",
                    "MyApp.app.spike.panelChannels=this.getSpikeChannelChartPanel();",
                    "MyApp.app.spike.data=null; //This is given value in loadSpikeData",
                    "MyApp.app.spike.mode=0;// 0 means candle, uncorrected",
                    "",
                    "this.loadSpikeData(MyApp.app.spike);",
                    ""
                ]
            },
            "designerId": "cae7e7c1-7fa5-49d9-aae4-a0c378dd6cc8"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|params": [
                    "module"
                ],
                "fn": "loadSpikeData",
                "implHandler": [
                    "module.panel.setLoading(true);",
                    "",
                    "Ext.Ajax.request({",
                    "    url: '/nmdb/uncorrected/group/all/all/'+ module.N_points,",
                    "    success: function(response){",
                    "        var text = response.responseText;",
                    "        data=Ext.JSON.decode(text);",
                    "        module.data=data;",
                    "        this.initSpikeChart(module);",
                    "        this.initSpikeChannelChart();",
                    "        module.panel.setLoading(false);",
                    "    },",
                    "    scope: this",
                    "});"
                ]
            },
            "designerId": "93531de4-3ce6-475c-8a0b-6fb6cbbeaf6e"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "N_points": 0,
                "designer|params": [
                    "module"
                ],
                "fn": "initSpikeChart",
                "implHandler": [
                    "var yAxisPressHeight=100;  // You can change only this one.",
                    "var yAxisOhclHeight=module.panelHeight -yAxisPressHeight -165; //The 165 cant be changed",
                    "var yAxisOhclTop=yAxisPressHeight +50; //The 50 cant be changed",
                    "",
                    "var aux_scope=this; //  TODO. There must be better way",
                    "",
                    "var chart = new Highcharts.StockChart({",
                    "            chart: {",
                    "                renderTo: module.panel.getEl().dom,",
                    "                zoomType: 'x'",
                    "            },",
                    "",
                    "            global: {",
                    "                useUTC: true",
                    "            },",
                    "",
                    "            rangeSelector: {",
                    "                buttons: [{",
                    "                    type: 'month',",
                    "                    count: 1,",
                    "                    text: '1m'",
                    "                },{",
                    "                    type: 'all',",
                    "                    text: 'All'",
                    "                }],",
                    "                selected: 1,",
                    "\t\t\t\tinputEnabled: false",
                    "            },",
                    "",
                    "\t\t\txAxis : {",
                    "                events : {",
                    "                    afterSetExtremes : function(event){",
                    "                        chart.showLoading('Loading data from server...');  //  TODO maybe the ExtJs setloading",
                    "                        start=Math.round(event.min/1000);",
                    "                        finish=Math.round(event.max/1000);",
                    "",
                    "                        aux_scope.updateMode(start, finish, module);",
                    "                        aux_scope.updateData(start, finish, module);",
                    "                    }",
                    "\t\t\t\t},",
                    "\t\t\t\tminRange: 0.75*(module.N_points)/*one Min*/*60*1000,",
                    "                ordinal: false",
                    "\t\t\t},",
                    "",
                    "\t\t\tnavigator : {",
                    "                adaptToUpdatedData: false,",
                    "                series : {",
                    "                    data : module.data[0]",
                    "                }",
                    "            },",
                    "",
                    "            scrollbar: {",
                    "\t\t\t\tliveRedraw: false",
                    "\t\t\t},",
                    "",
                    "\t\t\tyAxis : [{",
                    "\t\t\t\ttitle: {",
                    "                    text: 'OHLC'",
                    "                },",
                    "                opposite: false,",
                    "                labels:{",
                    "                    x:10",
                    "                },",
                    "\t\t\t\ttop: yAxisOhclTop,",
                    "\t\t\t\theight: yAxisOhclHeight,",
                    "\t\t\t\tmin: 20,",
                    "\t\t\t\tmax: 251",
                    "\t\t\t},{",
                    "\t\t\t\ttitle: {",
                    "                    text: 'Presure'",
                    "                },",
                    "                opposite: false,",
                    "                labels:{",
                    "                    x:10",
                    "                },",
                    "\t\t\t\theight: yAxisPressHeight,",
                    "\t\t\t\toffset: 0,",
                    "\t\t\t\tmin: 880,",
                    "\t\t\t\tmax: 980",
                    "\t\t\t}],",
                    "",
                    "\t\t\tplotOptions: {",
                    "                column: {",
                    "                    pointPadding: 0.2,",
                    "                    borderWidth: 0",
                    "                }",
                    "            },",
                    "",
                    "            series:  [{",
                    "\t\t\t\tname : 'Uncorrected',\t\t\t\t//0",
                    "\t\t\t\ttype : 'candlestick',",
                    "\t\t\t\tdata : module.data[0],",
                    "\t\t\t\tdataGrouping: {",
                    "\t\t\t\t\tenabled: false",
                    "\t\t\t\t}",
                    "\t\t\t},{",
                    "\t\t\t\tname : 'Corrected for Pressure',\t//1",
                    "\t\t\t\ttype : 'candlestick',",
                    "\t\t\t\tdata : null,",
                    "\t\t\t\tdataGrouping: {",
                    "\t\t\t\t\tenabled: false",
                    "\t\t\t\t}",
                    "\t\t\t},{",
                    "\t\t\t\tname : 'Corrected for Efficiency',\t//2",
                    "\t\t\t\ttype : 'candlestick',",
                    "\t\t\t\tdata : null,",
                    "\t\t\t\tdataGrouping: {",
                    "\t\t\t\t\tenabled: false",
                    "\t\t\t\t}",
                    "\t\t\t},{",
                    "\t\t\t\tname : 'Uncorrected',\t\t\t\t//3",
                    "\t\t\t\tdata : null,",
                    "                id: 'Unc',",
                    "\t\t\t\tdataGrouping: {",
                    "\t\t\t\t\tenabled: false",
                    "\t\t\t\t}",
                    "\t\t\t},{",
                    "\t\t\t\tname : 'Corrected for Pressure',\t//4",
                    "\t\t\t\tdata : null,",
                    "\t\t\t\tdataGrouping: {",
                    "\t\t\t\t\tenabled: false",
                    "\t\t\t\t}",
                    "\t\t\t},{",
                    "\t\t\t\tname : 'Corrected for Efficiency',\t//5",
                    "\t\t\t\tdata : null,",
                    "\t\t\t\tdataGrouping: {",
                    "\t\t\t\t\tenabled: false",
                    "\t\t\t\t}",
                    "\t\t\t},{",
                    "\t\t\t\tname : 'Pressure',\t\t\t\t\t//6",
                    "\t\t\t\tvisible : true,",
                    "\t\t\t\tyAxis: 1,",
                    "\t\t\t\tdata : module.data[3],",
                    "\t\t\t\tdataGrouping: {",
                    "\t\t\t\t\tenabled: false",
                    "\t\t\t\t}",
                    "\t\t\t}]",
                    "});",
                    "",
                    "MyApp.app.chart=chart;  //  TODO remove",
                    "module.chart=chart;"
                ]
            },
            "configAlternates": {
                "N_points": "number"
            },
            "designerId": "9477a0c7-1ebc-4b63-b248-cb65b6b7b33b",
            "customConfigs": [
                {
                    "group": "(Custom Properties)",
                    "name": "N_points",
                    "type": "string"
                }
            ]
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|params": [
                    "start, end, N_points"
                ],
                "fn": "LineOrOhcl",
                "implHandler": [
                    "if ((finish-start)/60<=N_points*4+4)",
                    "            return true; //Line",
                    "    return false; //Ohcl"
                ]
            },
            "designerId": "da68100a-5c0b-4dd7-9a1e-6651fa6f5335"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|params": [
                    "start, finish, module"
                ],
                "fn": "updateMode",
                "implHandler": [
                    "if (this.LineOrOhcl(start, finish, module.N_points) && module.mode<3)",
                    "        module.mode +=3;",
                    "",
                    "    if (!this.LineOrOhcl(start, finish, module.N_points) && module.mode>=3)",
                    "        module.mode -=3;"
                ]
            },
            "designerId": "cc5edeeb-c63a-4e04-a2a4-115aad06c325"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|params": [
                    "series, module"
                ],
                "fn": "changeSeries",
                "implHandler": [
                    "if(module.mode>=3)",
                    "    series +=3;",
                    "module.mode=series;",
                    "this.updateSeries(module);"
                ]
            },
            "designerId": "e86907c6-a536-45ad-8bc3-47cd9544f3a5"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|params": [
                    "module"
                ],
                "fn": "updateSeries",
                "implHandler": [
                    "from_data=module.mode%3;",
                    "module.chart.series[0].setData([]);",
                    "module.chart.series[1].setData([]);",
                    "module.chart.series[2].setData([]);",
                    "module.chart.series[3].setData([]);",
                    "module.chart.series[4].setData([]);",
                    "module.chart.series[5].setData([]);",
                    "module.chart.series[6].setData(module.data[3]);",
                    "",
                    "module.chart.series[module.mode].setData(module.data[from_data]);"
                ]
            },
            "designerId": "d85de4bb-952d-45ae-9b70-95bb74ec5471"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|params": [
                    "start, finish, module"
                ],
                "fn": "updateData",
                "implHandler": [
                    "var my_url=null;",
                    "if (this.LineOrOhcl(start, finish, module.N_points)){",
                    "    my_url='/nmdb/uncorrected/raw/'+start+'/'+finish;",
                    "    Ext.ComponentQuery.query('#Chart2Button')[0].enable(true);",
                    "}else{",
                    "    my_url='/nmdb/uncorrected/group/'+start+'/'+finish+'/'+module.N_points;",
                    "    Ext.ComponentQuery.query('#Chart2Button')[0].disable(true);",
                    "}",
                    "",
                    "",
                    "Ext.Ajax.request({",
                    "        url: my_url,",
                    "        success: function(response){",
                    "            var text = response.responseText;",
                    "            data=Ext.JSON.decode(text);",
                    "",
                    "            module.data=data;",
                    "            this.updateSeries(module);",
                    "",
                    "            module.chart.hideLoading();",
                    "            module.chart.hideLoading();",
                    "",
                    "        },",
                    "        scope: this",
                    "    });",
                    ""
                ]
            },
            "designerId": "e30f8b30-0c46-481b-837a-5de0973dc324"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "fn": "initSpikeChannelChart",
                "implHandler": [
                    "var series = null;",
                    "var panel= MyApp.app.spike.panelChannels;",
                    "var height= MyApp.app.spike.panelHeight;",
                    "var width= MyApp.app.spike.panelWidth;",
                    "",
                    "var chartChannels = new Highcharts.StockChart({",
                    "    chart: {",
                    "        renderTo: panel.getEl().dom,",
                    "        height: height,",
                    "        width: width",
                    "    },",
                    "    title: {",
                    "        text: 'Hi there Spikes'",
                    "    },",
                    "    legend : {",
                    "        enabled: true",
                    "    },",
                    "    scrollbar:{",
                    "        enabled: false",
                    "    },",
                    "    navigator:{",
                    "        enabled: false",
                    "    },",
                    "    rangeSelector: {",
                    "        buttons: [],",
                    "        inputEnabled: false",
                    "    },",
                    "    yAxis:[{",
                    "        title: {",
                    "            text: 'Values'",
                    "        },",
                    "        opposite: false,",
                    "        labels:{",
                    "            x:10",
                    "        }",
                    "    }],",
                    "    xAxis:{",
                    "        ordinal: false",
                    "    },",
                    "    series: [{",
                    "        name: 'ch01',",
                    "        data: series,",
                    "        tooltip: {",
                    "            valueDecimals: 0",
                    "        },",
                    "        legendIndex: 1",
                    "    },",
                    "    {",
                    "        name: 'ch02',",
                    "",
                    "        data: series,",
                    "        tooltip: {",
                    "            valueDecimals: 0",
                    "        },",
                    "        legendIndex: 2",
                    "    },{",
                    "        name: 'ch03',",
                    "",
                    "        data: series,",
                    "        tooltip: {",
                    "            valueDecimals: 0",
                    "        },",
                    "        legendIndex: 3",
                    "    },{",
                    "        name: 'ch04',",
                    "",
                    "        data: series,",
                    "        tooltip: {",
                    "            valueDecimals: 0",
                    "        },",
                    "        legendIndex: 4",
                    "    },{",
                    "        name: 'ch05',",
                    "",
                    "        data: series,",
                    "        tooltip: {",
                    "            valueDecimals: 0",
                    "        },",
                    "        legendIndex: 5",
                    "    },{",
                    "        name: 'ch06',",
                    "",
                    "        data: series,",
                    "        tooltip: {",
                    "            valueDecimals: 0",
                    "        },",
                    "        legendIndex: 6",
                    "    },{",
                    "        name: 'ch07',",
                    "",
                    "        data: series,",
                    "        tooltip: {",
                    "            valueDecimals: 0",
                    "        },",
                    "        legendIndex: 7",
                    "    },{",
                    "        name: 'ch08',",
                    "",
                    "        data: series,",
                    "        tooltip: {",
                    "            valueDecimals: 0",
                    "        },",
                    "        legendIndex: 8",
                    "    },{",
                    "        name: 'ch09',",
                    "",
                    "        data: series,",
                    "        tooltip: {",
                    "            valueDecimals: 0",
                    "        },",
                    "        legendIndex: 9",
                    "    },{",
                    "        name: 'ch10',",
                    "",
                    "        data: series,",
                    "        tooltip: {",
                    "            valueDecimals: 0",
                    "        },",
                    "        legendIndex: 10",
                    "    },{",
                    "        name: 'ch11',",
                    "",
                    "        data: series,",
                    "        tooltip: {",
                    "            valueDecimals: 0",
                    "        },",
                    "        legendIndex: 11",
                    "    },{",
                    "        name: 'ch12',",
                    "",
                    "        data: series,",
                    "        tooltip: {",
                    "            valueDecimals: 0",
                    "        },",
                    "        legendIndex: 12",
                    "    },{",
                    "        name: 'ch13',",
                    "",
                    "        data: series,",
                    "        tooltip: {",
                    "            valueDecimals: 0",
                    "        },",
                    "        legendIndex: 13",
                    "    },{",
                    "        name: 'ch14',",
                    "",
                    "        data: series,",
                    "        tooltip: {",
                    "            valueDecimals: 0",
                    "        },",
                    "        legendIndex: 14",
                    "    },{",
                    "        name: 'ch15',",
                    "",
                    "        data: series,",
                    "        tooltip: {",
                    "            valueDecimals: 0",
                    "        },",
                    "        legendIndex: 15",
                    "    },{",
                    "        name: 'ch16',",
                    "",
                    "        data: series,",
                    "        tooltip: {",
                    "            valueDecimals: 0",
                    "        },",
                    "        legendIndex: 16",
                    "    },{",
                    "        name: 'ch17',",
                    "",
                    "        data: series,",
                    "        tooltip: {",
                    "            valueDecimals: 0",
                    "        },",
                    "        legendIndex: 17",
                    "    },{",
                    "        name: 'ch18',",
                    "",
                    "        data: series,",
                    "        tooltip: {",
                    "            valueDecimals: 0",
                    "        },",
                    "        legendIndex: 18",
                    "    }]",
                    "});",
                    "",
                    "MyApp.app.chartChannels=chartChannels;  //  TODO remove",
                    "MyApp.app.spike.chartChannels=chartChannels;"
                ]
            },
            "designerId": "b344ac78-d987-4b48-8483-8b373793dbc4"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|params": [
                    "module"
                ],
                "fn": "updateChannelData",
                "implHandler": [
                    "module.chartChannels.showLoading('Loading data from server...');",
                    "start=Math.round(module.chart.xAxis[0].min/1000);",
                    "finish=Math.round(module.chart.xAxis[0].max/1000);",
                    "my_url='/nmdadb/rawdata/'+start+'/'+finish;",
                    "",
                    "Ext.Ajax.request({",
                    "    url: my_url,",
                    "    success: function(response){",
                    "        var text = response.responseText;",
                    "        data=Ext.JSON.decode(text);",
                    "",
                    "        for (var i=0;i<=17;i++){",
                    "            module.chartChannels.series[i].setData(data[i]);",
                    "        }",
                    "",
                    "        module.chartChannels.hideLoading();",
                    "        module.chartChannels.hideLoading();",
                    "",
                    "    },",
                    "    scope: this",
                    "});"
                ]
            },
            "designerId": "81351275-49cf-4ec2-a64d-c697fa37c797"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|params": [
                    "start, finish, module"
                ],
                "fn": "searchInterval",
                "implHandler": [
                    "module.chart.xAxis[0].setExtremes(",
                    "\t\t\t\t\tthis.getTimestamp(start),",
                    "\t\t\t\t\tthis.getTimestamp(finish));"
                ]
            },
            "designerId": "f4092216-bb4a-4007-abcc-c9cb4f4353af"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|params": [
                    "str"
                ],
                "fn": "getTimestamp",
                "implHandler": [
                    "var d = str.match(/\\d+/g); //extract date parts",
                    "return +new Date(Date.UTC(d[0], d[1] - 1, d[2], d[3], d[4], d[5])); //build Date object"
                ]
            },
            "designerId": "37b209b0-597b-472f-88da-f0c1a8d8b529"
        },
        {
            "type": "controllerref",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "ref": "SpikeChartPanel",
                "selector": "#SpikeChartPanel"
            },
            "designerId": "72244de8-99cf-4b0c-b106-9ec157ad13e1"
        },
        {
            "type": "controllerref",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "ref": "SpikeChannelChartPanel",
                "selector": "#SpikeChannelChartPanel"
            },
            "designerId": "f9b8c75d-677d-4a81-b4ad-0c9447c2a79d"
        }
    ]
}